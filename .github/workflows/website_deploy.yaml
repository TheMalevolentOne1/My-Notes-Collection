name: Convert and Publish Markdown to HTML

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Install Pandoc
      run: sudo apt-get install -y pandoc

    - name: Convert Markdown to HTML
      run: |
        find . -name "*.md" -exec sh -c 'pandoc "$0" -o "${0%.md}.html}"' {} \;
        mv "Welcome To My Notes!.html" "index.html"

    - name: Configure Git
      env:
        EMAIL_ADDRESS: ${{ secrets.EMAIL_ADDRESS }}
      run: |
        git config --global user.email "$EMAIL_ADDRESS"
        git config --global user.name "Your Name"

    - name: Delete old branch
      run: |
        git fetch origin
        if git show-ref --quiet refs/heads/pages-html; then
          git push origin --delete pages-html
        fi

    - name: Create new branch and push changes
      run: |
        git checkout -b pages-html
        git add .
        git commit -m "Deploy to GitHub Pages"
        git push origin pages-html

    - name: Deploy to GitHub Pages
      uses: JamesIves/github-pages-deploy-action@v4.4.1
      with:
        branch: pages-html
        folder: ./
        token: ${{ secrets.GITHUB_TOKEN }}
